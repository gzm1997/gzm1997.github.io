<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>gzm&#39;s blogs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="gzm&#39;s blogs">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="gzm&#39;s blogs">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gzm&#39;s blogs">
  
    <link rel="alternate" href="/atom.xml" title="gzm&#39;s blogs" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">gzm&#39;s blogs</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-sysu教务选课系统登陆" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/15/sysu教务选课系统登陆/" class="article-date">
  <time datetime="2018-05-15T15:01:05.000Z" itemprop="datePublished">2018-05-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/15/sysu教务选课系统登陆/">sysu教务选课系统登陆</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>准备：<br>python3<br>安装tesseract,本人提供的tesseract百度云下载，亲测版本4比较多坑，这是版本3，已经够用的了<br>链接: <a href="http://pan.baidu.com/s/1boHp2Jt" target="_blank" rel="noopener">http://pan.baidu.com/s/1boHp2Jt</a> 密码: 6trj</p>
<hr>
<ul>
<li>下载本项目到本地</li>
<li>进入主目录，输入以下命令安装相关依赖：</li>
</ul>
<pre><code>pip install -r requirements.txt
</code></pre><ul>
<li><p>在如下59和64行输入你的账号和密码：<br><img src="https://github.com/15331094/sysu_login/blob/master/screenshots/input.png?raw=true" alt="输入账号密码"></p>
</li>
<li><p>输入一下命令运行代码：</p>
<p> python login.py</p>
</li>
</ul>
<p>运行之后打印不少内容：<br>第一个是一个byte,内容就是下载下来的验证码：<br><img src="https://github.com/15331094/sysu_login/blob/master/screenshots/icode.png?raw=true" alt="验证码"><br>第二个是登陆后的页面：<br><img src="https://github.com/15331094/sysu_login/blob/master/screenshots/after_login.png?raw=true" alt="登陆之后"><br>第三个是我的选课结果：<br><img src="https://github.com/15331094/sysu_login/blob/master/screenshots/my_lesson.png?raw=true" alt="选课结果"></p>
<hr>
<p>最后可以发现本地生成了一个after_login.html的html文件，打开之后发现你的选课结果被下载下来了：<br><img src="https://github.com/15331094/sysu_login/blob/master/screenshots/lession.png?raw=true" alt="选课结果"></p>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><ul>
<li>icode模块负责图片去噪和识别验证码</li>
<li>entryption模块负责加密密码</li>
<li>login模块负责登陆和抓取一些页面</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/15/sysu教务选课系统登陆/" data-id="cji8g3r3b000feko0dhk6121d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/requests/">requests</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-上传和展示pdf以及markdown" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/15/上传和展示pdf以及markdown/" class="article-date">
  <time datetime="2018-05-15T14:57:44.000Z" itemprop="datePublished">2018-05-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/15/上传和展示pdf以及markdown/">上传和展示pdf以及markdown</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><p><a href="http://138.68.235.123/upload" target="_blank" rel="noopener">查看地址</a></p>
<p><a href="http://138.68.235.123/show?file_name=readme.pdf" target="_blank" rel="noopener">pdf版本readme地址</a></p>
<hr>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这个是开学前跟别人赌气写下的一个很小的web app，功能是上传pdf文件，然后获得这个文件在线浏览的url，需求很简单。之前为了方便只是把上传到服务器的文件存在flask static文件夹下，会有不便于管理等等问题。这个周末做了如下改进：使用mysql进行存储文件，进行模块的细化。</p>
<p align="right">郭柱明 2018/3/25</p>


<hr>
<h2 id="可行性分析"><a href="#可行性分析" class="headerlink" title="可行性分析"></a>可行性分析</h2><blockquote>
<p>从需求上而言，这个web app仅仅有上传，展示两个功能。<br>我一个人可以进行开发，但是在人力物力上已经绰绰有余。<br>在app的服务器部署上，我有一个digital ocean vps可以用来部署，所以部署上也没有太大问题。</p>
</blockquote>
<hr>
<h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><ol>
<li>上传pdf文件</li>
<li>获得在线浏览此pdf文件的url</li>
<li>打开这个url可以进行文件的预览</li>
</ol>
<hr>
<h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><p>###大概设计###</p>
<p><img src="http://static.zybuluo.com/gzm1997/5de0ll4jozkxxzntxo20ni2x/struction.png" alt="struction.png-12.1kB"></p>
<p>整个结构呈现cs结构，server我使用nginx，server使用wsgi接口调用flask app</p>
<p>###详细设计###</p>
<ul>
<li>包-pdf(整个web app打包为一个包)<ul>
<li>db.py模块(定义一个包含数据库链接的类以及初始化数据库的函数)</li>
<li>f.py模块(定义File类)</li>
</ul>
</li>
</ul>
<hr>
<h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><blockquote>
<p>编码情况详细见<a href="https://github.com/gzm1997/pdf" target="_blank" rel="noopener">github</a></p>
</blockquote>
<hr>
<h2 id="测试与运行"><a href="#测试与运行" class="headerlink" title="测试与运行"></a>测试与运行</h2><p><img src="http://static.zybuluo.com/gzm1997/v93gqdz11aenv30kisr64r41/pdf.gif" alt="pdf.gif-631.7kB"></p>
<hr>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><blockquote>
<p>部署有个问题：无法从事先设置的环境变量中加载出mysql的账号和密码，在服务器上调试没问题，但是一旦部署上去就会在这部分出问题，无奈下只能在代码使用mysql的账号密码，有一定的安全风险。</p>
</blockquote>
<hr>
<h2 id="后期改进"><a href="#后期改进" class="headerlink" title="后期改进"></a>后期改进</h2><blockquote>
<p>增加了上传和预览markdown文件的功能，具有改进为博客系统的潜质</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/15/上传和展示pdf以及markdown/" data-id="cji8g3r3b000ieko0juxsdckm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flask/">flask</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-暗网爬虫" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/15/暗网爬虫/" class="article-date">
  <time datetime="2018-05-15T14:54:11.000Z" itemprop="datePublished">2018-05-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/15/暗网爬虫/">暗网爬虫</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>暗网蜘蛛，本项目<a href="https://github.com/15331094/shadow_spider" target="_blank" rel="noopener">github地址</a></p>
<hr>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/spider.jpg?raw=true" alt="shadow_spider"></p>
<hr>
<p>暗网</p>
<blockquote>
<p>暗网（英语：Darknet或Dark Web）通称只能用特殊软件、特殊授权、或对电脑做特殊设置才能连上的网络，使用一般的浏览器和搜索引擎找不到暗网的内容</p>
</blockquote>
<hr>
<h2 id="在python上进入暗网"><a href="#在python上进入暗网" class="headerlink" title="在python上进入暗网"></a>在python上进入暗网</h2><hr>
<p>在python中进入暗网需要配置tor代理，因为本人使用的win10，所以主要讲在win10下配置tor代理</p>
<hr>
<p><strong>下载准备</strong>：（除了下载给出的下载链接，本人此项目github也提供相关资源下载 <a href="https://github.com/15331094/shadow_spider/tree/master/resources" target="_blank" rel="noopener">下载链接</a>）</p>
<ol>
<li><p>首先下载tor expert bundle<br>官方下载<a href="https://www.torproject.org/download/download" target="_blank" rel="noopener">链接</a><br>本人提供的百度云<a href="http://pan.baidu.com/s/1eRNpqa2" target="_blank" rel="noopener">链接</a>，密码: fsp8<br>下载解压</p>
</li>
<li><p>下载到的tor expert bundle没有图形界面，使用起来不方便，因此需要下载Vidalia配合使用<br>本人提供的百度云<a href="http://pan.baidu.com/s/1bOdr6e" target="_blank" rel="noopener">链接</a>，密码: kknf</p>
</li>
<li><p>cow下载，百度云<a href="http://pan.baidu.com/s/1c1QHf1m" target="_blank" rel="noopener">连接</a>，密码: c4kx。<br>由于tor使用的协议是socks5，由于需要python的<strong>requests</strong>和<strong>selenium</strong>两个模块进行get， post请求。但是经过本人尝试，requests对socks5协议代理支持是很不良好的，使用requests加上socks5协议代理去get类似于 <a href="https://api.ipify.org/?format=json" target="_blank" rel="noopener">https://api.ipify.org/?format=json</a> 这样查询ip的url是没有问题的，但是去get其他url或者暗网的url马上会出现莫名其妙的错误。所以需要使用cow把tor的socks5协议转为http协议</p>
</li>
</ol>
<hr>
<p><strong>配置</strong></p>
<hr>
<p>我们要配置上面下载到的工具，使得我们的代理路线如下：<br><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/net.png?raw=true" alt="net"><br>1,解压下载下来的tor expert bundle</p>
<p>2,开启你的vpn，本人使用的green vpn，socks5协议，监听1080端口</p>
<p>3,安装vidalia，安装后如图所示：</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/vidalia.png?raw=true" alt="vidalia"></p>
<p>然后以<strong>管理员身份</strong>运行Start Vidalia.exe</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/vidalia%20run.png?raw=true" alt="vidalia run"></p>
<p>点击设定，在常规那里选中vidalia启动时运行tor软件，并在下面的路径中找到解压tor expert bundle后得到的tor.exe</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/setting1.png?raw=true" alt="setting1"></p>
<p>点击网络，选中我使用代理服务器连接网络，由于本人使用的green vpn是监听本地的1080端口，所以地址写为：127.0.0.1，端口写为：1080（貌似shadowsocks等vpn也是监听本地1080端口）</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/setting2.png?raw=true" alt="setting2"></p>
<p>点击高级，在tor配置文件下选中vidalia安装后得到的Data/Tor/torrc文件，在数据目录那里选中Data文件夹（貌似我是多余地自己另外创建了一个Data文件夹给它，但是并不影响，有一个Data文件夹给vidalia存储数据就可以了）</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/setting3.png?raw=true" alt="setting3"></p>
<p>点击确认</p>
<p>点击启动tor</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/run.png?raw=true" alt="run"></p>
<p>稍等片刻，显示连接tor网络成功！</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/connect.png?raw=true" alt="connect"></p>
<p>因为需要在requests模块上使用tor代理而requests模块对socks5支持非常不良好，所以我们需要配置cow把socks5转为http<br>打开解压后的cow目录：</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/cow.png?raw=true" alt="cow"></p>
<p>修改rc.txt内容为如下：</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/rc.png?raw=true" alt="rc"></p>
<p>点击运行cow.exe或者点击cow-hide.exe后台运行</p>
<hr>
<p><strong>在python中使用tor代理</strong></p>
<hr>
<p>再次重申上面配置好的代理结构：</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/net.png?raw=true" alt="net"></p>
<p>能否正常使用tor代理一个很好的检验方法就是能否<strong>进入暗网</strong>，这是一个收集了很多暗网url的网站：<a href="https://onionlinks.org/" target="_blank" rel="noopener">https://onionlinks.org/</a></p>
<p>我给出一个暗网url:<strong><a href="http://hcutffpecnc44vef.onion/" target="_blank" rel="noopener">http://hcutffpecnc44vef.onion/</a></strong><br>这是一个暗网的金融网站，普通的上网方式是打不开的，作为一个大哥哥，真心建议18-的小朋友还是不要去看暗网一些其他内容，为了你的身心健康。那下面的测试就是在python中进入这个暗网url为检验标准。</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/cash%20machine.png?raw=true" alt="cash machine"></p>
<p><em>在requests中进入暗网</em>：<br>新建一个test.py,输入以下内容：</p>
<pre><code>import requests
proxies = {&apos;http&apos;: &apos;http://127.0.0.1:7777&apos;, &apos;https&apos;: &apos;http://127.0.0.1:7777&apos;}
s = requests.Session()
r = s.get(&quot;http://hcutffpecnc44vef.onion/&quot;, proxies = proxies)
print(r.text)
f = open(&quot;onion.html&quot;, &quot;wb&quot;)
f.write(r.content)
f.close()
</code></pre><p>运行，发现可以打印这个暗网网页的内容出来了：</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/run%20test.png?raw=true" alt="run test"></p>
<p>打开test.py同一目录下，生成了一个onion.html的文件，点开，发现把内容也下载下来了：</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/get.png?raw=true" alt="get"></p>
<p><em>在python的selenium模块的模拟浏览器phantomjs中进入暗网</em><br>selenium有三种，chrome，firefox，phantomjs，前两种有图形界面，第三种没有图形界面，所以我选中phantomjs</p>
<p>phantomjs下载：<br>本人github上的下载<a href="https://github.com/15331094/shadow_spider/blob/master/resources/phantomjs-2.1.1-windows.zip" target="_blank" rel="noopener">下载链接</a><br>本人百度云<a href="http://pan.baidu.com/s/1eSxNa86" target="_blank" rel="noopener">下载链接</a>，密码: pj81</p>
<p>这次我们选择另一个暗网url:<a href="http://zqktlwi4fecvo6ri.onion/wiki/index.php/Main_Page" target="_blank" rel="noopener">http://zqktlwi4fecvo6ri.onion/wiki/index.php/Main_Page</a><br>这是一个暗网wiki，上面有很多分类好的暗网url,各位要谨慎点开那些url，因为不少内容不健康的。<br>下载phantomjs解压，新建一个test2.py文件(下面的executable_path是上面下载解压phantomjs得到的phantomjs.exe运行文件的路径)</p>
<pre><code>from selenium import webdriver

executable_path = &quot;C:/Users/Administrator/Downloads/phantomjs-2.1.1-windows/phantomjs-2.1.1-windows/bin/phantomjs.exe&quot;
service_args = [&apos;--proxy=127.0.0.1:7777&apos;, &apos;--proxy-type=http&apos;]

driver = webdriver.PhantomJS(executable_path = executable_path, service_args = service_args)

driver.get(&quot;http://zqktlwi4fecvo6ri.onion/wiki/index.php/Main_Page&quot;)

print(driver.page_source)

f = open(&quot;onion.html&quot;, &quot;wb&quot;)
f.write(driver.page_source.encode(&quot;utf-8&quot;))
f.close()
</code></pre><p>结果也可行：</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/run%20test2.png?raw=true" alt="run test2"><br><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/wiki.png?raw=true" alt="wiki"></p>
<hr>
<h2 id="本人的shadow-spider项目（未完待续）"><a href="#本人的shadow-spider项目（未完待续）" class="headerlink" title="本人的shadow_spider项目（未完待续）"></a>本人的shadow_spider项目（未完待续）</h2><hr>
<p>项目<a href="https://github.com/15331094/shadow_spider" target="_blank" rel="noopener">github地址</a><br>本项目目的在于最大程度还原暗网上网页的内容，这就意味着需要：</p>
<p>注意要点：</p>
<ul>
<li>下载html</li>
<li>在下载html之前必须加载javascript。因为javascript里面会有ajax，如果把javascript下载下来，而不是加载完javascript再下载html，那么下载到本地ajax向tor网络（暗网）中的服务器发送网络请求，这是行不通的。所以必须加载完javascript再下载html（网上有人说暗网上的网页都没有javascript，但是经本人尝试，暗网上的网页是有javascript的）。而python里加载javascript一个很好的工具就是上面的selenium</li>
<li>下载css和图片等静态资源，需要使用requests模块，不能使用selenium。selenium下载图片和css等资源是很蛋疼的。因为这些模拟浏览器要下载资源就必须做到模仿我们在真的浏览器上那样右键另存为等操作，而这时候会弹出下载确认的弹窗，而selenium中的chrome和firefox是需要手动点击代码运行过程中弹出来的确认保存弹窗的，而phantomjs没有图形界面，所以就根本下载不图片和css等资源。</li>
</ul>
<p>代码细节不详细说了，在我的<a href="https://github.com/15331094/shadow_spider" target="_blank" rel="noopener">github</a>中下载到本地，输入：</p>
<pre><code>pip install -r requirements.txt
</code></pre><p>安装需要的响应模块</p>
<p>运行main.py文件，输入一个暗网url:</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/run%20main.png?raw=true" alt="run main"></p>
<p>下载到本地的结果：</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/result.png?raw=true" alt="result"></p>
<p>下面是一些暗网网页真实模样和我还原的样子：<br>真实1：</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/real1.png?raw=true" alt="real1"></p>
<p>还原1：</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/imitate1.png?raw=true" alt="imitate1"></p>
<p>真实2：</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/real2.png?raw=true" alt="real2"></p>
<p>还原2：</p>
<p><img src="https://github.com/15331094/shadow_spider/blob/master/screenshots/imitate2.png?raw=true" alt="imitate2"></p>
<p>此项目shadow_spider未完待续，等到暑假回考虑添加服务端。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/15/暗网爬虫/" data-id="cji8g3r3b000peko0x7qobke4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/deep-web/">deep web</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-sqlalchemy级联" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/15/sqlalchemy级联/" class="article-date">
  <time datetime="2018-05-15T14:37:01.000Z" itemprop="datePublished">2018-05-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/15/sqlalchemy级联/">sqlalchemy级联</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="relationship"><a href="#relationship" class="headerlink" title="relationship"></a>relationship</h2><p>relationship是sqlalchemy中的用于创建两个对象之间的关系的一个对象，跟原本的mysql没有太大关系，但是relationship一定要建立在具有外键关系的两个对象上</p>
<p>例如<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">"user"</span></span><br><span class="line">    id = Column(Integer, primary_key = <span class="keyword">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">20</span>))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">"article"</span></span><br><span class="line">    id = Column(Integer, primary_key = <span class="keyword">True</span>)</span><br><span class="line">    user_id = Column(Integer, ForeignKey(<span class="string">"user.id"</span>))</span><br><span class="line">    user = relationship(<span class="string">"User"</span>, order_by = <span class="string">"Article.id"</span>, backref = backref(<span class="string">"article"</span>), cascade = <span class="string">"save-update, merge, delete"</span>)</span><br></pre></td></tr></table></figure></p>
<p>user和article之间是一对多的关系，由于article具有</p>
<pre><code>user = relationship(&quot;User&quot;, order_by = &quot;Article.id&quot;, backref = backref(&quot;article&quot;), cascade = &quot;save-update, merge, delete&quot;)
</code></pre><p>字段，所以article具有user属性，也即article.user可以获取article对应的user</p>
<p>同时因为</p>
<pre><code>backref = backref(&quot;article&quot;)
</code></pre><p>使得user具有article属性，由外键关系知道user和article为一对多关系，所以，user.article类型为[]。</p>
<p>backref和back_populates<br>stackoverflow上对两者的解释</p>
<blockquote>
<p>If you use backref you don’t need to declare the relationship on the second table</p>
</blockquote>
<p>就是使用backref就不用再两个具有外键的类上都声明relationship。</p>
<p>backref<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'parent'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    children = relationship(<span class="string">"Child"</span>, backref=<span class="string">"parent"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'child'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    parent_id = Column(Integer, ForeignKey(<span class="string">'parent.id'</span>))</span><br></pre></td></tr></table></figure></p>
<p>back_populates<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'parent'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    children = relationship(<span class="string">"Child"</span>, back_populates=<span class="string">"parent"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'child'</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    parent_id = Column(Integer, ForeignKey(<span class="string">'parent.id'</span>))</span><br><span class="line">    parent = relationship(<span class="string">"Parent"</span>, back_populates=<span class="string">"children"</span>)</span><br></pre></td></tr></table></figure></p>
<p>上面两者是等价的</p>
<hr>
<h2 id="cascade级联"><a href="#cascade级联" class="headerlink" title="cascade级联"></a>cascade级联</h2><p>例子中</p>
<pre><code>cascade = &quot;save-update, merge, delete&quot;
</code></pre><p>属性用来表示这两个关联起来的对象的增删的时候之间的关系</p>
<p><strong>cascade默认值为save-update, merge</strong></p>
<p><strong>为了表达更清晰</strong>，声明了relationship属性的类我们称之为<strong>子类</strong>，没有声明的我们称之为<strong>父类</strong>，使用上面的user和article例子<br><img src="http://static.zybuluo.com/gzm1997/09845m65v996usjz8kr4dc9n/image_1cdi1seaqu2sntue61gq51la29.png" alt="image_1cdi1seaqu2sntue61gq51la29.png-6.8kB"></p>
<p>1.save-update</p>
<ul>
<li>当user被add到session中的时候，两个article也自动被add到session中了</li>
<li>当article1被添加到session中时，user自动被添加进session，同时article2也会自动被添加进去</li>
</ul>
<p>2.delete</p>
<ul>
<li>当删除子对象时，父对象也一起被删除，如果子对象有指向父对象的外键且这个外键指向这个被删除的父对象，那么这个外键设置为null</li>
<li>当删除父对象时，子对象没有删除，如果子对象有指向父对象的外键且这个外键指向这个被删除的父对象，那么外键设置为null</li>
</ul>
<p>3.delete-orphan</p>
<blockquote>
<p>delete-orphan实在delete的基础上，加上当子对象被解除跟父对象的关系的时候就会被标志为删除</p>
</blockquote>
<p>4.其他还有merge，refresh-expire，expunge那些不常用的就不要求理解了</p>
<hr>
<h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, String, Integer, ForeignKey, create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker, relationship, backref</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">"user"</span></span><br><span class="line">    id = Column(Integer, primary_key = <span class="keyword">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">20</span>))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">"article"</span></span><br><span class="line">    id = Column(Integer, primary_key = <span class="keyword">True</span>)</span><br><span class="line">    user_id = Column(Integer, ForeignKey(<span class="string">"user.id"</span>))</span><br><span class="line">    user = relationship(<span class="string">"User"</span>, order_by = <span class="string">"Article.id"</span>, backref = backref(<span class="string">"article"</span>), cascade = <span class="string">"save-update, merge, delete"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">engine = create_engine(<span class="string">'mysql+mysqlconnector://root:Gzm20125@localhost:3306/test'</span>)</span><br><span class="line">DBSession = sessionmaker(bind = engine)</span><br><span class="line"></span><br><span class="line">Base.metadata.drop_all(engine)</span><br><span class="line">Base.metadata.create_all(engine)</span><br><span class="line"><span class="comment"># 创建session对象:</span></span><br><span class="line"></span><br><span class="line">session = DBSession()</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/15/sqlalchemy级联/" data-id="cji8g3r2w000deko0n26z1sfs" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlalchemy/">sqlalchemy</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-多维数组最短路径问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/06/多维数组最短路径问题/" class="article-date">
  <time datetime="2018-05-06T08:18:02.079Z" itemprop="datePublished">2018-05-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/06/多维数组最短路径问题/">多维数组最短路径问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>题目<br>给定一个矩阵m，从左上角开始每次只能向右或者向下走，最后到达右下角的位置，路径上所有的数字累加起来就是路径和，返回所有路径中最小的路径和。<br>例子：<br>给定m如下：<br>1 3 5 9<br>8 1 3 4<br>5 0 6 1<br>8 8 4 0<br>路径1,3,1,0,6,1,0是所有路径中路径和最小的，所以返回12。</p>
<blockquote>
<p>一般这种这种问题可以通过动态规划来解决，因为去年没选算法导论，一直对动态规划这个概念理解不是很清楚</p>
</blockquote>
<p>维基百科上的解释为<br>动态规划（英语：Dynamic programming，简称DP）是一种在数学、管理科学、计算机科学、经济学和生物信息学中使用的，通过把原问题分解为相对简单的子问题的方式求解复杂问题的方法。</p>
<p>以往的斐波那契数列和背包问题都是用到动态规划的思想，只是一直知道这就是动态规划而已。</p>
<p>最短路径问题：<br>设一个数组dp[n][n]，用来存从0，0点到这一点的最短路径和，对于每一点dp[i][j]的值，它等于min(dp[i-1][j], dp[i][j-1]) + arr[i][j]，特别的，dp[0][0] = arr[0][0]，对于第一行，dp[0][j] = dp[0][j - 1] + arr[0][j]对于第一列，dp[i][0] = dp[i-1][0] + arr[i][0]</p>
<p>代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arr = sys.stdin.readline().strip().split(<span class="string">" "</span>)</span><br><span class="line">arr = [[int(i) <span class="keyword">for</span> i <span class="keyword">in</span> arr]]</span><br><span class="line"></span><br><span class="line">num = len(arr[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(num<span class="number">-1</span>):</span><br><span class="line">    new_arr = sys.stdin.readline().strip().split(<span class="string">" "</span>)</span><br><span class="line">    new_arr = [int(i) <span class="keyword">for</span> i <span class="keyword">in</span> new_arr]</span><br><span class="line">    arr.append(new_arr)</span><br><span class="line"></span><br><span class="line">dp = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(num)] <span class="keyword">for</span> i <span class="keyword">in</span> range(num)]</span><br><span class="line">dp[<span class="number">0</span>][<span class="number">0</span>] = arr[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,num):</span><br><span class="line">	dp[<span class="number">0</span>][i] = dp[<span class="number">0</span>][i<span class="number">-1</span>] + arr[<span class="number">0</span>][i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,num):</span><br><span class="line">	dp[i][<span class="number">0</span>] = dp[<span class="number">0</span>][i<span class="number">-1</span>] + arr[<span class="number">0</span>][i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,num):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,num):</span><br><span class="line">		dp[i][j] = min(dp[i<span class="number">-1</span>][j], dp[i][j<span class="number">-1</span>]) + arr[i][j]</span><br><span class="line"></span><br><span class="line">print(dp[num<span class="number">-1</span>][num<span class="number">-1</span>])</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/06/多维数组最短路径问题/" data-id="cji8g3r3b000neko099m4k4e3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/算法/">算法</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-flask包调用中的的路径问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/06/flask包调用中的的路径问题/" class="article-date">
  <time datetime="2018-05-06T08:00:53.415Z" itemprop="datePublished">2018-05-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/06/flask包调用中的的路径问题/">flask包调用中的的路径问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>这篇短文写在我的腾讯一面搞砸之后，这次面试让我深刻认识到我一直是一个很功利的人。总结了一下一共有几个要点：</p>
<ul>
<li><strong>看需求办事</strong>，有什么需求谷歌什么，查看文档相关部分，而其他的部分置之不理，全然没有深入学习的决心</li>
<li>对一个框架没有深入了解，仅仅止步于<strong>工具化</strong>，也没有对框架有更深层的了解，这让我很惭愧</li>
<li>做事<strong>没有从工程层面</strong>来思考问题，仅仅从个人角度思考问题</li>
</ul>
</blockquote>
<hr>
<h2 id="flask包调用过程中的路径问题"><a href="#flask包调用过程中的路径问题" class="headerlink" title="flask包调用过程中的路径问题"></a>flask包调用过程中的路径问题</h2><p>假设有如下情况,my_app是封装为包的一个flask app，app声明在my_app/__init__.py文件中，h.py是包内的一个辅助模块，在run_app.py中调用my_app这个包的flask app进行运行</p>
<ul>
<li>my_app<ul>
<li>static</li>
<li>templates</li>
<li>__init__.py</li>
<li>h.py</li>
</ul>
</li>
<li>run_app.py</li>
</ul>
<hr>
<p>###在辅助模块h.py中加载static中的静态文件###<br>当情况是运行run_app.py，而h.py需要加载static中静态文件的时候，在h.py中使用的路径可以是两种情况：</p>
<ul>
<li>绝对路径</li>
<li>相对路径 ./my_app/static/file_name</li>
</ul>
<blockquote>
<p>注意包调用情况下，如果包内非__init__模块要加载static内静态文件，需要使用从包外路径开始定位</p>
</blockquote>
<hr>
<p>###html内加载静态文件###<br>当情况是运行run_app.py，html内需要加载静态文件，路径必须是相对路径，形式为：/static/file_name</p>
<hr>
<p>###实例文件夹###<br>flask除了提供 app.static_folder和app.template_folder之外<br><img src="http://static.zybuluo.com/gzm1997/pjq99hklds5g8hdm90oqgvk6/image_1c8h30e029l51fi92jdv9f1rbt9.png" alt="image_1c8h30e029l51fi92jdv9f1rbt9.png-7.8kB"><br>flask还提供了instance_path<br><img src="http://static.zybuluo.com/gzm1997/ymyj8prm5y05y2psgjni1ct9/image_1c8h31ai6r1hidf187l10fo6q6m.png" alt="image_1c8h31ai6r1hidf187l10fo6q6m.png-4.3kB"><br>instance_path也可以用来存放静态文件，但是要注意的是instance_path所在的位置</p>
<p>flask文档对instance_path位置的阐述如下：</p>
<ul>
<li>未安装的模块:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/myapp.py</span><br><span class="line">/instance</span><br></pre></td></tr></table></figure>
<ul>
<li>未安装的包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/myapp</span><br><span class="line">    /__init__.py</span><br><span class="line">/instance</span><br></pre></td></tr></table></figure>
<ul>
<li>已安装的包或模块:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$PREFIX/lib/python2.X/site-packages/myapp</span><br><span class="line">$PREFIX/var/myapp-instance</span><br></pre></td></tr></table></figure>
<blockquote>
<p>$PREFIX 是你 Python 安装的前缀。这个前缀可以是 /usr 或者你的 virtualenv 的路径。你可以打印 sys.prefix 的值来查看前缀被设置成了什么</p>
</blockquote>
<p>所以上面已经阐述得很清楚了，在我们包调用的情况下，instance_path是跟my_app并列的位置上的，所以可以在my_app/__init__.py内的app使用app.instance_path来加载位于与my_app并列的instance中的静态文件，如下：</p>
<ul>
<li>instance<ul>
<li>static_file_to_load</li>
</ul>
</li>
<li>my_app</li>
<li>run.py</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/06/flask包调用中的的路径问题/" data-id="cji8g3r2g0001eko0qnvznj2i" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flask深入学习/">flask深入学习</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql的charset和collate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/06/mysql的charset和collate/" class="article-date">
  <time datetime="2018-05-06T07:13:47.250Z" itemprop="datePublished">2018-05-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/06/mysql的charset和collate/">mysql的charset和collate</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="mysql的charset"><a href="#mysql的charset" class="headerlink" title="mysql的charset"></a>mysql的charset</h2><p>charset用于给数据库确定使用哪种编码方式进行编码<br><img src="http://static.zybuluo.com/gzm1997/rmk5nlv1sadhg885fh9kmj1h/image_1ccpviqo3i3d1tbs1fd22p470h9.png" alt="image_1ccpviqo3i3d1tbs1fd22p470h9.png-76.1kB"></p>
<hr>
<h2 id="mysql的collate"><a href="#mysql的collate" class="headerlink" title="mysql的collate"></a>mysql的collate</h2><p>collate叫做数据库的校验，就是一种对字符串进行比较的规则<br><img src="http://static.zybuluo.com/gzm1997/q3s6k93zkqtubpt4t60sxu5f/image_1ccpvon1q16g6b0v16dh1gkuh4qm.png" alt="image_1ccpvon1q16g6b0v16dh1gkuh4qm.png-90.6kB"></p>
<p>stackoverflow上对charset和collate的解释：</p>
<blockquote>
<p>A character set is a set of symbols and encodings. A collation is a set of rules for comparing characters in a character set. Let’s make the distinction clear with an example of an imaginary character set.</p>
</blockquote>
<hr>
<h2 id="mysql中常用的编码和校验方式"><a href="#mysql中常用的编码和校验方式" class="headerlink" title="mysql中常用的编码和校验方式"></a>mysql中常用的编码和校验方式</h2><p>###utf-8和unicode###<br>unicode是确定字符的编码值，但是具体怎么用多大的空间来存储室没有确定的，在计算机系统中，存储在硬件的使用试用unicode进行编码，读出来进行读写是使用utf-8进行编码的</p>
<p>###utf-8和ascii###<br>ascii编码是使用7位来进行编码的，utf-8是小的字符用一字节，多的用到2字节到4字节，当时utf-8用一字节进行编码的时候和ascii一样。</p>
<p>###utf-8和latin1###<br>Latin1是ISO-8859-1的别名，顾名思义，1这种编码方式可以编码拉丁字母，ISO-8859-1收录的字符除ASCII收录的字符外，还包括西欧语言、希腊语、泰语、阿拉伯语、希伯来语对应的文字符号。如果用latin1来编码非拉丁字母的中文日文等就会出现乱码。latin1用一字节来存储一个字符。</p>
<hr>
<h2 id="mysql实践中的问题"><a href="#mysql实践中的问题" class="headerlink" title="mysql实践中的问题"></a>mysql实践中的问题</h2><p>问题阐述<br>mysql database的编码和校验方式会影响mysql连接器(比如我一直是用mysql.connector)在查询varchar的时候，将结果返回为bytearray的形式还是是正常的string类型。charset为utf-8时，varchar字段的查询结果返回类型为bytearray，虽然这个问题可以在直接使用mysql.conector的时候自己decode一下来解决，但是当mysql.connector配合sqlalchemy这样的orm一起使用的时候，问题就尤为明显，而且难以解决。在sqlalchemy配合mysql.connector中，query函数中传入varchar类型的字段作为查询的条件的时候，报错：typeerror：bytearray is not hashalbe。显示返回的查询类型是bytearray，并且这是不可哈希的类型，所以sqlalchemy的查询报错。</p>
<p>问题原因<br>这应该是mysql.connector 2版本自己的设计或者一个bug，因为详细可以看<a href="https://dev.mysql.com/doc/relnotes/connector-python/en/news-2-0-0.html" target="_blank" rel="noopener">Connector/Python 2.0.0官方文档说明</a><br><img src="http://static.zybuluo.com/gzm1997/i2rbpzyz7egslkfpnhsxbsmy/image_1ccq0rujm13qo1ln46ulrl51c4d13.png" alt="image_1ccq0rujm13qo1ln46ulrl51c4d13.png-28.1kB"><br>这里说明，connector版本1返回值的类型是正常的，python2返回时字符串，python3是bytes，但是到了connector版本2，无论哪个版本的python返回值一律都是bytearray</p>
<p>解决方案<br>据我观察</p>
<ul>
<li>charset为utf-8，返回值类型为bytearray</li>
<li>charset为latin1，返回值类型为string</li>
<li>charset为gbk，返回值类型为string，而gbk可以对中文编码</li>
</ul>
<p>所以得出上面所说的，数据库的charset可以影响connector的返回值类型，这很迷，谷歌搜到的解释很多事stackoverflow上的，对于这个问题也是众说纷纭，所以也不知道这算是一个bug还是connector本身的一个设计。<strong>上面这样解决也要考虑当存储非拉丁字符时会出现乱码的情况。</strong></p>
<p>在创建database时确定它的charset和collate</p>
<pre><code>CREATE DATABASE db_name CHARACTER SET latin1 COLLATE latin1_swedish_ci;
</code></pre><p>latin1_swedish_ci意为瑞典的一个拉丁字符比较方式，ci意为不计较大小写。</p>
<p>通过上面设置database的charset和collate的方式就可以让connector的varchar返回类型为string，sqlalchemy的query不报错了。</p>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在mysql.connector+sqlalchemy对mysql进行含有中文字段的row进行增删查找，可以设置数据库的charset为gbk。这样mysql.connector查询的返回值为string，sqlalchemy的query不会报错。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database test2 DEFAULT CHARACTER SET gbk COLLATE gbk_chinese_ci;</span><br></pre></td></tr></table></figure>
<p>测试代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, String, Integer, create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建对象的基类:</span></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义User对象:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'user'</span></span><br><span class="line">    id = Column(String(<span class="number">20</span>), primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">20</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化数据库连接:</span></span><br><span class="line">engine = create_engine(<span class="string">'mysql+mysqlconnector://root:Gzm20125@localhost:3306/test'</span>)</span><br><span class="line"><span class="comment"># 创建DBSession类型:</span></span><br><span class="line">DBSession = sessionmaker(bind=engine)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Base.metadata.drop_all(engine)</span></span><br><span class="line">Base.metadata.create_all(engine)</span><br><span class="line"><span class="comment"># 创建session对象:</span></span><br><span class="line"></span><br><span class="line">session = DBSession()</span><br><span class="line"><span class="comment"># 创建新User对象:</span></span><br><span class="line">new_user = User(id=<span class="string">"5"</span>, name=<span class="string">'Bob'</span>)</span><br><span class="line"><span class="comment"># 添加到session:</span></span><br><span class="line">session.add(new_user)</span><br><span class="line"><span class="comment"># 提交即保存到数据库:</span></span><br><span class="line">session.commit()</span><br><span class="line"><span class="comment"># 关闭session:</span></span><br><span class="line">session.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Session:</span></span><br><span class="line">session = DBSession()</span><br><span class="line"><span class="comment"># 创建Query查询，filter是where条件，最后调用one()返回唯一行，如果调用all()则返回所有行:</span></span><br><span class="line">user = session.query(User).filter_by(id = <span class="string">"5"</span>).one()</span><br><span class="line"><span class="comment"># 打印类型和对象的name属性:</span></span><br><span class="line">print(<span class="string">'type:'</span>, type(user))</span><br><span class="line">print(<span class="string">'name:'</span>, user.name)</span><br><span class="line"><span class="comment"># 关闭Session:</span></span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></p>
<p><img src="http://static.zybuluo.com/gzm1997/wlrv4j9geyg8q2bzjkpmcj21/image_1ccq1cgd91bo6hl21le3fpo1d6v1g.png" alt="image_1ccq1cgd91bo6hl21le3fpo1d6v1g.png-8.3kB"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/06/mysql的charset和collate/" data-id="cji8g3r2w0008eko0z4opp5ib" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ORM/">ORM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aiohttp/">aiohttp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/async/">async</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/backend/">backend</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cors/">cors</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deep-web/">deep web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deploy/">deploy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask/">flask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flask深入学习/">flask深入学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/image/">image</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/package/">package</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/requests/">requests</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlalchemy/">sqlalchemy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件开发生命周期/">软件开发生命周期</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ORM/" style="font-size: 10px;">ORM</a> <a href="/tags/aiohttp/" style="font-size: 16.67px;">aiohttp</a> <a href="/tags/async/" style="font-size: 13.33px;">async</a> <a href="/tags/backend/" style="font-size: 10px;">backend</a> <a href="/tags/cors/" style="font-size: 10px;">cors</a> <a href="/tags/deep-web/" style="font-size: 10px;">deep web</a> <a href="/tags/deploy/" style="font-size: 10px;">deploy</a> <a href="/tags/flask/" style="font-size: 10px;">flask</a> <a href="/tags/flask深入学习/" style="font-size: 10px;">flask深入学习</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/image/" style="font-size: 10px;">image</a> <a href="/tags/java/" style="font-size: 13.33px;">java</a> <a href="/tags/mysql/" style="font-size: 20px;">mysql</a> <a href="/tags/package/" style="font-size: 10px;">package</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/requests/" style="font-size: 10px;">requests</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/sqlalchemy/" style="font-size: 13.33px;">sqlalchemy</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a> <a href="/tags/软件开发生命周期/" style="font-size: 10px;">软件开发生命周期</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/06/10/aiohttp的跨域问题/">aiohttp的跨域问题</a>
          </li>
        
          <li>
            <a href="/2018/06/08/nginx-supervisor部署aiohttp/">nginx+supervisor部署aiohttp</a>
          </li>
        
          <li>
            <a href="/2018/06/08/java-socket编程/">java socket编程</a>
          </li>
        
          <li>
            <a href="/2018/06/04/java基础知识/">java基础知识</a>
          </li>
        
          <li>
            <a href="/2018/05/26/python包调用问题/">python包调用问题</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 gzm1997<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>